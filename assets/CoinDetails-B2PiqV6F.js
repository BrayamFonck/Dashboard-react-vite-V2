import{b as F,a as H,r as i,j as e,L as U}from"./index-B5nbigFH.js";import{c as K,ar as l,as as k,at as b,au as V,av as _,T as L,a as A,aw as B,ax as G}from"./coingeckoService-Dn-p7-oK.js";import{E}from"./ErrorMessage-CKNmMepo.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],C=K("arrow-left",O),J=()=>{const{coinId:t}=F(),j=H(),[z,D]=i.useState(!0),[h,c]=i.useState(""),[a,T]=i.useState(null),[N,$]=i.useState([]),[g,I]=i.useState(7),[m,y]=i.useState(!1),[S,P]=i.useState(null),[d,M]=i.useState(!1);i.useEffect(()=>{t&&v()},[t,g]);const v=async()=>{try{D(!0),c(""),y(!1),console.log(`üöÄ Loading data for coin: ${t}`);const[s,o]=await Promise.all([l.getCoinById(t).catch(async x=>{console.error(`‚ùå Error loading coin details for ${t}:`,x.message);const f=l.getCacheKey("coinById",{id:t}),n=l.persistentCache.get(f);if(n&&Date.now()-n.timestamp<l.fallbackCacheTimeout)return console.warn(`üîÑ Using fallback cache data for coin ${t} (age: ${Math.floor((Date.now()-n.timestamp)/1e3)}s)`),y(!0),n.data;throw x}),l.getCoinHistory(t,g).catch(async x=>{console.error(`‚ùå Error loading historical data for ${t}:`,x.message);const f=l.getCacheKey("history",{coinId:t,days:g}),n=l.persistentCache.get(f);return n&&Date.now()-n.timestamp<l.fallbackCacheTimeout?(console.warn(`üîÑ Using fallback cache data for historical ${t} (age: ${Math.floor((Date.now()-n.timestamp)/1e3)}s)`),m||y(!0),n.data):{prices:[]}})]);if(T(s),o&&o.prices&&o.prices.length>0){const x=o.prices.map(([f,n])=>({timestamp:f,price:n.toFixed(2)}));$(x)}else $([]);P(new Date),m?(c(`Mostrando datos guardados para ${s.name}. La informaci√≥n puede no estar actualizada.`),console.warn(`‚ö†Ô∏è Loaded ${t} with fallback data`)):console.log(`‚úÖ Fresh data loaded successfully for ${t}`)}catch(s){console.error(`üí• Critical error loading coin data for ${t}:`,{error:s.message,stack:s.stack,coinId:t,timeRange:g}),a?(c("No se pudieron actualizar los datos. Mostrando informaci√≥n anterior."),console.warn(`‚ö†Ô∏è Keeping previous data for ${t} due to error`)):c("Error al cargar los datos de la moneda. Por favor, intenta de nuevo.")}finally{D(!1)}},R=s=>{I(s)},w=async()=>{M(!0),c("");try{console.log(`üîÑ Manual refresh initiated for ${t}`),l.cleanExpiredCache(),await v(),!h&&!m&&console.log(`‚úÖ Manual refresh completed successfully for ${t}`)}catch(s){console.error(`Error during manual refresh for ${t}:`,s),c("Error al actualizar los datos. Mostrando informaci√≥n disponible.")}finally{M(!1)}},p=s=>s>=1?`$${s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${s.toFixed(6)}`,u=s=>{if(!s)return"N/A";const o=s>=0;return e.jsxs("span",{className:`inline-flex items-center ${o?"text-green-600":"text-red-600"}`,children:[o?e.jsx(L,{className:"w-4 h-4 mr-1"}):e.jsx(A,{className:"w-4 h-4 mr-1"}),o?"+":"",s.toFixed(2),"%"]})};if(z&&!a)return e.jsx(U,{message:"Cargando detalles de la moneda..."});if(h&&!a)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(k,{}),e.jsxs("div",{className:"pt-20 px-4",children:[e.jsx(E,{message:h,onClose:()=>c("")}),e.jsxs("div",{className:"text-center mt-6",children:[e.jsxs("button",{onClick:()=>j("/dashboard"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mr-4",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Volver al Dashboard"]}),e.jsxs("button",{onClick:v,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Reintentar"]})]})]})]});if(!a)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(k,{}),e.jsxs("div",{className:"pt-20 px-4 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"No se encontraron datos para esta moneda."}),e.jsxs("button",{onClick:()=>j("/dashboard"),className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Volver al Dashboard"]})]})]});const r=a.market_data;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(k,{}),e.jsx("div",{className:"pt-20 pb-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("button",{onClick:()=>j("/dashboard"),className:"inline-flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Volver al Dashboard"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[m&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-amber-600 bg-amber-50 px-3 py-1 rounded-lg border border-amber-200",children:[e.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Datos guardados - Puede no estar actualizado"})]}),S&&!m&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{children:["Actualizado: ",S.toLocaleTimeString()]})]}),e.jsxs("button",{onClick:w,disabled:d,className:"flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm","aria-label":d?"Actualizando datos":"Actualizar datos de la moneda",children:[e.jsx(b,{className:`w-4 h-4 ${d?"animate-spin":""}`,"aria-hidden":"true"}),e.jsx("span",{children:d?"Actualizando...":"Actualizar"})]})]})]})}),h&&a&&e.jsx("div",{className:"mb-6",role:"alert","aria-live":"polite",children:e.jsx(E,{message:h,onClose:()=>c("")})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-0",children:[e.jsx("img",{src:a.image.large,alt:a.name,className:"w-16 h-16 rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:a.name}),e.jsx("p",{className:"text-lg text-gray-600 uppercase",children:a.symbol}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsxs("span",{className:"text-sm bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Ranking #",a.market_cap_rank||"N/A"]})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-2",children:p(r.current_price.usd)}),e.jsx("div",{className:"text-lg",children:u(r.price_change_percentage_24h)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Cap. de Mercado"})]}),e.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:["$",l.formatNumber(r.market_cap.usd)]}),e.jsx("p",{className:"text-sm text-gray-500",children:u(r.market_cap_change_percentage_24h)})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(_,{className:"w-5 h-5 text-green-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Volumen 24h"})]}),e.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:["$",l.formatNumber(r.total_volume.usd)]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(L,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"M√°ximo 24h"})]}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:p(r.high_24h.usd)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(A,{className:"w-5 h-5 text-orange-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"M√≠nimo 24h"})]}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:p(r.low_24h.usd)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Informaci√≥n del Mercado"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Suministro Circulante:"}),e.jsx("span",{className:"font-medium",children:r.circulating_supply?l.formatNumber(r.circulating_supply):"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Suministro Total:"}),e.jsx("span",{className:"font-medium",children:r.total_supply?l.formatNumber(r.total_supply):"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ATH:"}),e.jsx("span",{className:"font-medium text-green-600",children:p(r.ath.usd)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Cambios de Precio"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"1 hora:"}),u(r.price_change_percentage_1h_in_currency?.usd)]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"7 d√≠as:"}),u(r.price_change_percentage_7d)]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"30 d√≠as:"}),u(r.price_change_percentage_30d)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Enlaces"}),e.jsxs("div",{className:"space-y-2",children:[a.links.homepage[0]&&e.jsxs("a",{href:a.links.homepage[0],target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Sitio Web Oficial"]}),a.links.blockchain_site[0]&&e.jsxs("a",{href:a.links.blockchain_site[0],target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Explorador Blockchain"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 sm:mb-0",children:["Precio Hist√≥rico de ",a.name]}),e.jsx("div",{className:"flex space-x-2",children:[1,7,30,90,365].map(s=>e.jsx("button",{onClick:()=>R(s),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${g===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s===1?"1D":s===7?"7D":s===30?"1M":s===90?"3M":"1Y"},s))})]}),e.jsx("div",{className:"h-96",children:N&&N.length>0?e.jsx(G,{data:N,title:"",coinName:a.name,showTitle:!1}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg font-medium",children:"No hay datos hist√≥ricos disponibles"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Los datos del gr√°fico no pudieron cargarse para el per√≠odo seleccionado"}),e.jsxs("button",{onClick:w,className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Reintentar carga de gr√°fico"]})]})})})]}),a.description.en&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mt-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:["Acerca de ",a.name]}),e.jsx("div",{className:"text-gray-700 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:a.description.en.split(".")[0]+"."}})]}),m&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mt-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-amber-800 font-medium",children:"Informaci√≥n sobre los datos mostrados"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:"Los datos mostrados fueron obtenidos de cache local debido a limitaciones temporales de la API. La informaci√≥n puede no reflejar los valores m√°s recientes del mercado. Intenta actualizar en unos minutos para obtener datos frescos."}),e.jsxs("button",{onClick:w,disabled:d,className:"mt-3 inline-flex items-center px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white rounded-md text-sm font-medium transition-colors disabled:opacity-50",children:[e.jsx(b,{className:`w-3 h-3 mr-1 ${d?"animate-spin":""}`}),d?"Actualizando...":"Intentar actualizar ahora"]})]})]})})]})})]})};export{J as default};
